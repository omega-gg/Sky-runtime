#!/bin/sh
set -e

#--------------------------------------------------------------------------------------------------
# Settings
#--------------------------------------------------------------------------------------------------

ffmpeg="${SKY_PATH_FFMPEG:-"$PWD/../../user/bin/ffmpeg"}"

strength="10"

filter="gblur"

#--------------------------------------------------------------------------------------------------
# Syntax
#--------------------------------------------------------------------------------------------------

if [ $# -lt 2 -o $# -gt 4 ]; then

    echo "Usage: blur <input> <output> [strength = 10] [filter = gblur]"
    echo ""
    echo "filter: gblur"
    echo "        boxblur"
    echo "        smartblur"

    exit 1
fi

#--------------------------------------------------------------------------------------------------
# Configuration
#--------------------------------------------------------------------------------------------------

if [ $# -gt 2 ]; then

    strength="$3"
fi

if [ $# -gt 3 ]; then

    filter="$4"
fi

if [ $filter = "gblur" ]; then

    filter="gblur=sigma"

    strength="$strength:steps=6"
fi

#--------------------------------------------------------------------------------------------------
# Run
#--------------------------------------------------------------------------------------------------

"$ffmpeg" -y -i "$1" -vf "$filter=$strength" "$2"
