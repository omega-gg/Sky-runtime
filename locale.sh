#!/bin/sh
set -e

#--------------------------------------------------------------------------------------------------
# Settings
#--------------------------------------------------------------------------------------------------

project="Sky-runtime.pro"

external="$PWD/../3rdparty"

#--------------------------------------------------------------------------------------------------

Qt4_version="4.8.7"
Qt5_version="5.15.2"
Qt6_version="6.10.1"

#--------------------------------------------------------------------------------------------------
# environment

qt="qt6"

#--------------------------------------------------------------------------------------------------
# Syntax
#--------------------------------------------------------------------------------------------------

if [ $# != 1 -a $# != 2 ] \
   || \
   [ $1 != "win32" -a $1 != "win64" -a $1 != "macOS" -a $1 != "iOS" -a $1 != "linux" -a \
     $1 != "android" ] \
   || \
   [ $# = 2 -a "$2" != "release" ]; then

    echo "Usage: locale <win32 | win64 | macOS | iOS | linux | android> [release]"

    exit 1
fi

#--------------------------------------------------------------------------------------------------
# Configuration
#--------------------------------------------------------------------------------------------------

external="$external/$1"

if [ $qt = "qt4" ]; then

    Qt="$external/Qt/$Qt4_version"

elif [ $qt = "qt5" ]; then

    Qt="$external/Qt/$Qt5_version"
else
    Qt="$external/Qt/$Qt6_version"
fi

if [ $qt = "qt6" ]; then

    if [ $1 = "iOS" ]; then

        QtBin="$Qt/macos/bin"

    elif [ $1 = "android" ]; then

        QtBin="$Qt/gcc_64/bin"
    else
        QtBin="$Qt/bin"
    fi
else
    QtBin="$Qt/bin"
fi

#--------------------------------------------------------------------------------------------------
# Update
#--------------------------------------------------------------------------------------------------

echo "UPDATING"
echo "--------"

lupdate="$QtBin/lupdate"

"$lupdate" -version
echo ""

"$lupdate" src/ content/ -recursive -ts dist/locale/fr_FR.ts

#--------------------------------------------------------------------------------------------------
# Release
#--------------------------------------------------------------------------------------------------

if [ "$2" != "release" ]; then

    exit 0
fi

echo "RELEASING"
echo "---------"

lrelease="$QtBin/lrelease"

"$lrelease" -version
echo ""

"$lrelease" dist/locale/*.ts

mv dist/locale/*.qm content/locale
